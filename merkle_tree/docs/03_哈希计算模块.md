# 哈希计算模块文档

## 概述

`src/core/hash.py` 模块实现了Git风格的哈希计算功能，是整个版本控制系统的核心组件之一。

## 功能特性

### 1. SHA-1哈希计算
- 支持字符串和字节数据的SHA-1哈希计算
- 返回40位十六进制字符串

### 2. Git对象哈希
- 实现Git对象格式：`<type> <size>\0<content>`
- 支持blob、tree、commit等对象类型
- 完全兼容Git的哈希计算方式

### 3. 文件内容哈希
- 直接读取文件内容并计算哈希
- 自动处理文件编码和异常情况

## 核心类和方法

### HashCalculator类

#### 静态方法

##### `sha1(data: Union[str, bytes]) -> str`
计算数据的SHA-1哈希值

**参数:**
- `data`: 要计算哈希的数据（字符串或字节）

**返回值:**
- 40位的十六进制哈希字符串

**示例:**
```python
hash_value = HashCalculator.sha1("Hello, World!")
# 返回: "4ca9653095931ef15cb6b02d72f621e1bcbb856b"
```

##### `hash_object(obj_type: str, content: Union[str, bytes]) -> str`
计算Git对象的哈希值

**参数:**
- `obj_type`: 对象类型（blob, tree, commit）
- `content`: 对象内容

**返回值:**
- 对象的哈希值

**示例:**
```python
blob_hash = HashCalculator.hash_object('blob', 'Hello, World!')
# 返回: "75f2f3893ad01074ceee67fb49cb90fac10f3f00"
```

##### `hash_file_content(file_path: str) -> str`
计算文件内容的哈希值

**参数:**
- `file_path`: 文件路径

**返回值:**
- 文件内容的哈希值

**异常:**
- `FileNotFoundError`: 文件不存在
- `Exception`: 读取文件失败

**示例:**
```python
file_hash = HashCalculator.hash_file_content('test.txt')
```

##### `hash_string_content(content: str) -> str`
计算字符串内容的哈希值

**参数:**
- `content`: 字符串内容

**返回值:**
- 内容的哈希值

**示例:**
```python
string_hash = HashCalculator.hash_string_content('Hello, World!')
```

## Git对象格式

Git对象遵循统一的格式：
```
<type> <size>\0<content>
```

其中：
- `<type>`: 对象类型（blob, tree, commit）
- `<size>`: 内容大小（字节数）
- `\0`: 空字符分隔符
- `<content>`: 实际内容

**示例:**
```
blob 13\0Hello, World!
```

## 技术实现

### 依赖库
- `hashlib`: Python标准库，提供哈希计算功能
- `typing`: Python标准库，提供类型注解

### 算法选择
- 使用SHA-1算法，与Git保持一致
- 支持UTF-8编码的字符串处理
- 自动处理字节数组和字符串转换

## 测试验证

模块已经过测试验证：

```python
# 基本功能测试
test_content = "Hello, World!"
print(HashCalculator.sha1(test_content))
# 输出: 4ca9653095931ef15cb6b02d72f621e1bcbb856b

# Git对象格式测试
blob_hash = HashCalculator.hash_object('blob', test_content)
print(blob_hash)
# 输出: 75f2f3893ad01074ceee67fb49cb90fac10f3f00
```

## 在Merkle Tree中的作用

1. **叶子节点哈希**: 为文件内容计算哈希值，作为Merkle Tree的叶子节点
2. **树节点哈希**: 为目录结构计算哈希值，作为Merkle Tree的内部节点
3. **完整性验证**: 通过哈希值验证数据完整性，确保数据未被篡改
4. **对象标识**: 为每个对象提供唯一标识符，支持对象存储和检索

## 注意事项

1. **哈希碰撞**: SHA-1存在理论上的碰撞风险，但在学习项目中可以接受
2. **性能考虑**: 对于大文件，需要考虑分块处理
3. **编码一致性**: 确保所有字符串使用UTF-8编码
4. **异常处理**: 文件操作需要适当的异常处理